version: "3.8"

services:
  trading-engine:
    build: .
    container_name: trading-engine
    ports:
      - "8787:8787"
    environment:
      - ENABLE_CRON=true
      - TRADING_SERVER_PORT=8787
      - TRADING_SERVER_HOST=0.0.0.0
      # Alpaca (paper trading)
      - ALPACA_API_KEY=${ALPACA_API_KEY:-}
      - ALPACA_SECRET_KEY=${ALPACA_SECRET_KEY:-}
      - ALPACA_PAPER=true
      # Binance
      - BINANCE_API_KEY=${BINANCE_API_KEY:-}
      - BINANCE_SECRET_KEY=${BINANCE_SECRET_KEY:-}
      - BINANCE_PAPER=true
      # 한국투자증권
      - KIS_APP_KEY=${KIS_APP_KEY:-}
      - KIS_APP_SECRET=${KIS_APP_SECRET:-}
      - KIS_ACCOUNT=${KIS_ACCOUNT:-}
      - KIS_MOCK=true
    volumes:
      # Persist trained models across container restarts
      - trading-models:/app/models
      - trading-logs:/app/logs
      - trading-data:/app/data
      - trading-config:/app/config
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8787/health')"]
      interval: 30s
      timeout: 10s
      start_period: 60s
      retries: 3

volumes:
  trading-models:
  trading-logs:
  trading-data:
  trading-config:
